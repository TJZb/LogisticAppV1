# การจัดการเลขไมล์รถพ่วงโดยไม่ต้องเพิ่มฟิลด์ในฐานข้อมูล

## แนวคิดการออกแบบ

### เหตุผลที่ไม่ต้องเพิ่มฟิลด์ `trailer_odometer_reading`:

1. **ระยะวิ่งเท่ากัน** - รถหลักและรถพ่วงขับไปด้วยกัน ดังนั้นระยะวิ่งจึงเท่ากัน
2. **ข้อมูลเก็บไว้แล้ว** - เลขไมล์ปัจจุบันของทั้งสองคันเก็บไว้ในตาราง `vehicles.current_mileage`
3. **คำนวณได้** - เลขไมล์รถพ่วง ณ เวลาใดๆ = เลขไมล์ปัจจุบัน + ระยะวิ่งรถหลัก

## วิธีการทำงาน

### การคำนวณเลขไมล์รถพ่วง:
```
เลขไมล์รถพ่วงใหม่ = เลขไมล์ปัจจุบันรถพ่วง + (เลขไมล์รถหลักใหม่ - เลขไมล์รถหลักเก่า)
```

### ข้อมูลที่ใช้:
1. **เลขไมล์ปัจจุบันรถพ่วง**: จาก `vehicles.current_mileage` (WHERE vehicle_id = trailer_vehicle_id)
2. **เลขไมล์รถหลักใหม่**: จากฟอร์มที่ผู้ใช้กรอก
3. **เลขไมล์รถหลักเก่า**: จาก `fuel_records.odometer_reading` ของการเติมน้ำมันครั้งก่อน

### การอัปเดตข้อมูล:
1. อัปเดต `vehicles.current_mileage` ของรถหลัก
2. อัปเดต `vehicles.current_mileage` ของรถพ่วง (ถ้ามี)
3. บันทึกเฉพาะเลขไมล์รถหลักใน `fuel_records.odometer_reading`

## ประโยชน์ของวิธีนี้

### ✅ **ข้อดี**:
- **ไม่ต้องแก้ไขโครงสร้างฐานข้อมูล** - ใช้ตารางที่มีอยู่
- **ประหยัดพื้นที่** - ไม่เก็บข้อมูลซ้ำซ้อน
- **ความถูกต้อง** - ข้อมูลคำนวณจากแหล่งเดียว ไม่มีการผิดพลาด
- **ความยืดหยุ่น** - สามารถคำนวณเลขไมล์ย้อนหลังได้ทุกเวลา

### ⚠️ **ข้อควรระวัง**:
- ต้องมีข้อมูลเลขไมล์ก่อนหน้าของรถหลักเพื่อคำนวณระยะวิ่ง
- ต้องมีข้อมูล `current_mileage` ในตาราง `vehicles` ของรถพ่วง

## การใช้งาน

### สำหรับ Manager/Admin:
1. เปิดรายการเติมน้ำมันที่มีรถพ่วง
2. ใส่เลขไมล์รถหลัก - ระบบจะแสดงเลขไมล์รถพ่วงที่คำนวณได้อัตโนมัติ
3. กดยืนยัน - ระบบจะอัปเดตเลขไมล์ของทั้งสองคันในตาราง `vehicles`

### การแสดงผลในฟอร์ม:
- แสดงเลขไมล์ปัจจุบันของรถพ่วง
- คำนวณและแสดงเลขไมล์ใหม่แบบเรียลไทม์
- อธิบายวิธีการคำนวณให้ผู้ใช้เข้าใจ

## ตัวอย่างการคำนวณ

```
รถหลัก:
- เลขไมล์เก่า: 100,000 กม.
- เลขไมล์ใหม่: 100,500 กม.
- ระยะวิ่ง: 500 กม.

รถพ่วง:
- เลขไมล์ปัจจุบัน: 50,000 กม.
- เลขไมล์ใหม่: 50,000 + 500 = 50,500 กม.
```

## ข้อสรุป

วิธีนี้ให้ผลลัพธ์เดียวกันกับการเพิ่มฟิลด์ใหม่ แต่:
- ไม่ต้องแก้ไขโครงสร้างฐานข้อมูล
- ไม่มีข้อมูลซ้ำซ้อน
- ง่ายต่อการบำรุงรักษา
- คำนวณได้แม่นยำและสอดคล้องกัน
